<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Daily English Infinite</title>
    <style>
        :root {
            --primary: #007AFF;
            --bg: #F2F2F7;
            --card-bg: #FFFFFF;
            --text: #000000;
            --red: #FF3B30;
            --green: #34C759;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background-color: var(--bg);
            margin: 0; padding: 0; height: 100vh;
            display: flex; flex-direction: column; overflow: hidden; color: var(--text);
        }

        /* HEADER & CONTROLES */
        .header {
            background: rgba(242, 242, 247, 0.95); backdrop-filter: blur(10px);
            padding: 40px 15px 10px 15px; border-bottom: 1px solid #ccc;
            z-index: 10; display: flex; flex-direction: column; gap: 10px;
        }

        .header-top { display: flex; justify-content: space-between; align-items: center; }
        .settings-btn { background: none; border: none; font-size: 20px; cursor: pointer; }

        .search-container { width: 100%; }
        .search-input {
            width: 100%; padding: 10px 15px; border-radius: 12px;
            border: 1px solid #ddd; background: #E5E5EA; font-size: 14px;
            box-sizing: border-box; outline: none;
        }

        /* SCROLL CATEGORIAS */
        .cat-scroll {
            display: flex; gap: 10px; overflow-x: auto; scrollbar-width: none; padding-bottom: 5px;
        }
        .cat-scroll::-webkit-scrollbar { display: none; }
        .cat-chip {
            background: #E5E5EA; padding: 8px 16px; border-radius: 20px;
            font-size: 13px; font-weight: 600; white-space: nowrap;
            color: #333; border: 1px solid transparent; transition: 0.2s;
        }
        .cat-chip.active { background: #000; color: white; box-shadow: 0 2px 8px rgba(0,0,0,0.2); }

        /* √ÅREA DE CONTE√öDO */
        .view-container { flex: 1; overflow-y: auto; padding: 20px; padding-bottom: 120px; }

        /* CARDS */
        .card {
            background: white; border-radius: 20px; padding: 25px; margin-bottom: 25px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.06); position: relative; border-left: 5px solid transparent;
        }
        .card.hard-mode { border-left: 5px solid var(--red); }
        .card-number { position: absolute; top: 20px; right: 20px; font-size: 11px; color: #ccc; font-weight: 600; }
        
        .card-header-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; padding-right: 30px; }
        .card-cat { font-size: 10px; font-weight: 800; color: #999; text-transform: uppercase; letter-spacing: 1px; }
        .toggle-hard-btn { background: none; border: none; font-size: 12px; color: #ccc; }
        .card.hard-mode .toggle-hard-btn { color: var(--red); font-weight: bold; }

        .en-text { font-size: 24px; font-weight: 800; color: var(--primary); margin-bottom: 10px; line-height: 1.2; }
        .pt-text { font-size: 18px; color: #333; margin-bottom: 15px; font-weight: 500; }
        .ctx-box { background: #f9f9f9; padding: 12px; border-radius: 10px; font-size: 13px; color: #555; line-height: 1.4; margin-bottom: 15px; }

        /* POST-ITS */
        .post-it-container { display: flex; flex-direction: column; gap: 8px; margin-top: 10px; }
        .post-it {
            background: #FFF8E1; border-left: 3px solid #FFC107; padding: 10px; border-radius: 6px;
            font-size: 13px; font-family: monospace; color: #444; display: flex; justify-content: space-between; align-items: center;
        }

        /* BOTOES A√á√ÉO */
        .card-actions { display: flex; gap: 10px; margin-top: 15px; border-top: 1px solid #eee; padding-top: 15px; }
        .act-btn {
            background: #F0F0F5; border: none; border-radius: 15px; padding: 8px 14px;
            font-size: 13px; font-weight: 600; color: #333; display: flex; align-items: center; gap: 5px; cursor: pointer;
        }

        /* BOT√ÉO GERAR INFINITO */
        .gen-btn {
            background: #000; color: white; width: 100%; border: none; padding: 18px; border-radius: 18px;
            font-size: 16px; font-weight: 700; box-shadow: 0 4px 12px rgba(0,0,0,0.2); margin-bottom: 30px;
            display: flex; justify-content: center; align-items: center; gap: 8px; transition: 0.3s;
        }
        .gen-btn:disabled { background: #999; transform: none; }

        /* BACKUP AREA */
        .backup-area { margin-top: 40px; padding-top: 20px; border-top: 1px solid #ddd; text-align: center; }
        .backup-btn { background: #E5E5EA; color: #333; border: 1px solid #ccc; padding: 10px 20px; border-radius: 10px; font-size: 12px; margin: 0 5px; }

        /* SRS MODE */
        .review-mode-container { height: 100%; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; }
        .flashcard { background: white; width: 90%; max-width: 350px; padding: 40px 20px; border-radius: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); min-height: 300px; display: flex; flex-direction: column; justify-content: center; }
        .hidden-content { display: none; margin-top: 20px; animation: fadeIn 0.3s; }
        .hidden-content.visible { display: block; }
        .srs-btns { display: flex; gap: 10px; justify-content: center; margin-top: 25px; }
        .srs-btn { padding: 15px 0; width: 100px; border-radius: 15px; border: none; font-weight: bold; color: white; font-size: 14px; }
        
        /* NAVBAR */
        .bottom-nav { position: fixed; bottom: 0; width: 100%; background: rgba(255,255,255,0.95); backdrop-filter: blur(10px); border-top: 1px solid #ccc; display: flex; height: 80px; justify-content: space-around; padding-top: 10px; z-index: 100; }
        .nav-item { background: none; border: none; color: #999; font-size: 10px; display: flex; flex-direction: column; align-items: center; gap: 4px; }
        .nav-item.active { color: var(--primary); }
        .badge { background: var(--red); color: white; font-size: 10px; padding: 2px 6px; border-radius: 10px; position: absolute; margin-top: -5px; margin-left: 15px; }

        /* MODAIS */
        .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.6); z-index: 200; display: flex; align-items: center; justify-content: center; opacity: 0; pointer-events: none; transition: 0.2s; }
        .modal-overlay.show { opacity: 1; pointer-events: auto; }
        .modal { background: white; width: 85%; max-width: 350px; border-radius: 20px; padding: 20px; max-height: 80vh; overflow-y: auto;}

        /* Lista de Categorias no Modal */
        .cat-list-item { display: flex; justify-content: space-between; align-items: center; padding: 10px 0; border-bottom: 1px solid #eee; }
        .cat-input { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 8px; margin-top: 10px; box-sizing: border-box;}

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .hidden { display: none !important; }
    </style>
</head>
<body>

    <div id="headerExplore" class="header">
        <div class="header-top">
            <h2 style="margin:0; font-size: 22px;">Meus Cards</h2>
            <button class="settings-btn" onclick="openSettings()">‚öôÔ∏è</button>
        </div>
        
        <div class="search-container">
            <input type="text" id="searchInput" class="search-input" placeholder="üîç Buscar express√£o..." onkeyup="handleSearch(this.value)">
        </div>

        <div class="cat-scroll" id="catScrollContainer">
            </div>
    </div>

    <div id="viewExplore" class="view-container">
        
        <button class="gen-btn" id="btnGenerate" onclick="generateCardFromInternet()">
            <span>‚ú®</span> Buscar Express√£o In√©dita (Internet)
        </button>

        <div id="feedList">
            <div style="text-align:center; color:#999; margin-top:40px;">Carregando...</div>
        </div>

        <div class="backup-area">
            <p style="font-size:10px; color:#999; margin-bottom:10px;">GERENCIAR DADOS LOCAIS</p>
            <button class="backup-btn" onclick="backupData()">‚¨áÔ∏è Fazer Backup</button>
            <button class="backup-btn" onclick="document.getElementById('restoreFile').click()">‚¨ÜÔ∏è Restaurar</button>
            <input type="file" id="restoreFile" style="display:none;" onchange="restoreData(this)">
        </div>
    </div>

    <div id="viewReview" class="view-container hidden" style="background:#f0f0f5;">
        <div class="review-mode-container" id="reviewContainer"></div>
    </div>

    <div id="modalEx" class="modal-overlay">
        <div class="modal">
            <h3>Novo Exemplo</h3>
            <p style="font-size:12px; color:#666;">Exemplo gerado para contexto adicional:</p>
            <div style="background:#f2f2f7; padding:15px; border-radius:10px; margin:15px 0; font-style:italic;" id="modalText">...</div>
            <div style="display:flex; gap:10px;">
                <button onclick="cycleModal()" style="flex:1; padding:10px; border:none; border-radius:8px; background:#ddd;">üîÑ Outro</button>
                <button onclick="speakModal()" style="padding:10px; border:none; border-radius:8px; background:#ddd;">üîä</button>
            </div>
            <button onclick="saveModal()" style="width:100%; margin-top:15px; background:black; color:white; padding:12px; border:none; border-radius:10px; font-weight:bold;">Salvar Post-it</button>
            <button onclick="closeModal('modalEx')" style="width:100%; margin-top:5px; background:none; color:red; padding:10px; border:none;">Cancelar</button>
        </div>
    </div>

    <div id="modalSettings" class="modal-overlay">
        <div class="modal">
            <h2 style="margin-top:0;">Configura√ß√µes</h2>
            
            <div style="background:#f9f9f9; padding:15px; border-radius:10px; margin-bottom:20px;">
                <h4 style="margin:0 0 10px 0;">üîë Chave da API (Gemini)</h4>
                <p style="font-size:12px; color:#666; margin:0 0 10px 0;">Necess√°ria para buscar cards infinitos na internet. Obtenha gr√°tis no Google AI Studio.</p>
                <input type="password" id="apiKeyInput" class="cat-input" placeholder="Cole sua API Key aqui..." style="margin-top:0;">
                <button onclick="saveApiKey()" style="margin-top:10px; background:black; color:white; border:none; padding:8px 15px; border-radius:8px; width:100%;">Salvar Chave</button>
            </div>

            <h4 style="margin:0 0 10px 0;">üìÇ Suas Categorias</h4>
            <div id="settingsCatList" style="max-height: 200px; overflow-y: auto; border: 1px solid #eee; border-radius: 8px; padding: 10px;">
                </div>
            
            <div style="display:flex; gap:10px; margin-top:15px;">
                <input type="text" id="newCatInput" class="cat-input" placeholder="Nova categoria..." style="margin-top:0;">
                <button onclick="addCategory()" style="background:var(--primary); color:white; border:none; padding:10px 15px; border-radius:8px;">Add</button>
            </div>

            <button onclick="closeModal('modalSettings')" style="width:100%; margin-top:20px; background:#ddd; color:#333; font-weight:bold; padding:12px; border:none; border-radius:10px;">Fechar</button>
        </div>
    </div>

    <div class="bottom-nav">
        <button class="nav-item active" id="navExp" onclick="switchView('explore')">
            <span style="font-size:24px;">üóÇÔ∏è</span>
            <span>Explorar</span>
        </button>
        <button class="nav-item" id="navRev" onclick="switchView('review')">
            <span style="font-size:24px;">üß†</span>
            <span>Revisar <span id="revBadge" class="badge hidden">0</span></span>
        </button>
    </div>

    <script>
        // --- GERENCIAMENTO DE ESTADO ---
        let userCards = JSON.parse(localStorage.getItem('englishApp_v6')) || [];
        let searchTerm = "";
        let reviewQueue = [];
        let currentReviewIndex = 0;
        let activeCardId = null;
        let tempExample = "";
        let pendingExamples = [];

        // Categorias Din√¢micas
        const defaultCats = ['Relacionamento', 'Fam√≠lia', 'Objetos', 'Lugares', 'Trabalho', 'Estudos', 'Elei√ß√µes', 'Economia', 'Comida'];
        let categories = JSON.parse(localStorage.getItem('englishApp_cats')) || defaultCats;
        let currentCat = localStorage.getItem('englishApp_lastCat') || 'all';

        // --- INICIALIZA√á√ÉO ---
        window.onload = () => {
            renderCategoryChips();
            updateReviewBadge();
            renderFeed();

            const savedScroll = localStorage.getItem('englishApp_scrollPos');
            if(savedScroll) {
                setTimeout(() => { document.getElementById('viewExplore').scrollTop = savedScroll; }, 100);
            }
        };

        document.getElementById('viewExplore').onscroll = function() {
            localStorage.setItem('englishApp_scrollPos', this.scrollTop);
        };

        // --- RENDERIZAR CATEGORIAS UI ---
        function renderCategoryChips() {
            const container = document.getElementById('catScrollContainer');
            container.innerHTML = `<button class="cat-chip ${currentCat === 'all' ? 'active' : ''}" onclick="filterCat('all')">Todos</button>`;
            
            categories.forEach(cat => {
                container.innerHTML += `<button class="cat-chip ${currentCat === cat ? 'active' : ''}" onclick="filterCat('${cat}')">${cat}</button>`;
            });
        }

        function filterCat(cat) {
            currentCat = cat;
            localStorage.setItem('englishApp_lastCat', cat);
            renderCategoryChips();
            renderFeed();
        }

        function handleSearch(text) {
            searchTerm = text.toLowerCase();
            renderFeed();
        }

        // --- GERADOR INFINITO (API) ---
        async function generateCardFromInternet() {
            const apiKey = localStorage.getItem('gemini_api_key');
            if(!apiKey) {
                alert("Para gerar cards infinitos da internet, voc√™ precisa configurar uma Chave de API primeiro.");
                openSettings();
                return;
            }

            const targetCat = currentCat === 'all' 
                ? categories[Math.floor(Math.random() * categories.length)] 
                : currentCat;

            const existingInCat = userCards.filter(c => c.cat === targetCat).slice(0, 15).map(c => c.en).join(", ");

            const btn = document.getElementById('btnGenerate');
            btn.disabled = true;
            btn.innerHTML = `‚è≥ Buscando na internet...`;

            // PROMPT ATUALIZADO E MAIS R√çGIDO
            const prompt = `Voc√™ √© um professor de ingl√™s nativo dos EUA. Crie um card de estudo com um vocabul√°rio, express√£o ou frase do dia a dia americano ESTRITAMENTE pertencente ao tema "${targetCat}". 
            √â obrigat√≥rio respeitar a categoria. Por exemplo, se a categoria for "Objetos", retorne obrigatoriamente um objeto f√≠sico. Se for "Trabalho", retorne algo do mundo corporativo. N√£o use g√≠rias aleat√≥rias se a categoria n√£o for "G√≠rias".
            Regra 1: N√ÉO repita estas express√µes: [${existingInCat}]. 
            Regra 2: Retorne APENAS um JSON v√°lido, sem formata√ß√£o markdown, sem backticks, estritamente neste formato:
            {
                "en": "A express√£o, objeto ou palavra em ingl√™s",
                "pt": "A tradu√ß√£o natural em portugu√™s do Brasil",
                "ctx": "Uma breve explica√ß√£o do contexto de uso no dia a dia",
                "exs": ["Exemplo de uso 1 em ingl√™s", "Exemplo de uso 2 em ingl√™s", "Exemplo de uso 3 em ingl√™s", "Exemplo de uso 4 em ingl√™s"]
            }`;

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: prompt }] }],
                        generationConfig: { temperature: 0.9 }
                    })
                });

                if(!response.ok) throw new Error("Falha na API. Verifique sua chave.");

                const data = await response.json();
                const textResponse = data.candidates[0].content.parts[0].text;
                
                const cleanJsonStr = textResponse.replace(/```json/g, '').replace(/```/g, '').trim();
                const result = JSON.parse(cleanJsonStr);

                const newCard = {
                    uid: Date.now().toString(),
                    cat: targetCat,
                    en: result.en,
                    pt: result.pt,
                    ctx: result.ctx,
                    availableExs: result.exs,
                    savedExs: [],
                    nextReview: Date.now(),
                    interval: 1,
                    isHard: false
                };

                userCards.unshift(newCard);
                saveData();
                
                if(currentCat !== 'all' && currentCat !== targetCat) {
                    filterCat(targetCat);
                } else {
                    renderFeed();
                }

                updateReviewBadge();
                document.getElementById('viewExplore').scrollTo({ top: 0, behavior: 'smooth' });

            } catch(err) {
                alert("Erro ao buscar na internet. Tente novamente ou verifique se sua API Key est√° correta.");
                console.error(err);
            } finally {
                btn.disabled = false;
                btn.innerHTML = `<span>‚ú®</span> Buscar Express√£o In√©dita (Internet)`;
            }
        }

        function renderFeed() {
            const feed = document.getElementById('feedList');
            feed.innerHTML = '';

            const filtered = userCards.filter(c => {
                const matchCat = currentCat === 'all' || c.cat === currentCat;
                const matchSearch = c.en.toLowerCase().includes(searchTerm) || 
                                    c.pt.toLowerCase().includes(searchTerm) || 
                                    c.ctx.toLowerCase().includes(searchTerm);
                return matchCat && matchSearch;
            });

            if(filtered.length === 0) {
                feed.innerHTML = '<div style="text-align:center; color:#999; margin-top:30px;">Nenhum card encontrado. Gere um novo!</div>';
                return;
            }

            filtered.forEach((card) => {
                const realIndex = userCards.findIndex(uc => uc.uid === card.uid);
                const cardNumber = userCards.length - realIndex;

                const exsHTML = card.savedExs.map(ex => `
                    <div class="post-it">
                        <span>üìù ${ex}</span>
                        <button onclick="speak('${ex.replace(/'/g, "\\'")}')" style="border:none; background:none;">üîä</button>
                    </div>
                `).join('');

                const html = `
                    <div class="card ${card.isHard ? 'hard-mode' : ''}">
                        <div class="card-number">#${cardNumber}</div>
                        <div class="card-header-row">
                            <span class="card-cat">${card.cat}</span>
                            <button class="toggle-hard-btn" onclick="toggleHard('${card.uid}')">
                                ${card.isHard ? '‚òÖ DIF√çCIL' : '‚òÜ Marcar Dif√≠cil'}
                            </button>
                        </div>
                        <div class="en-text">${card.en}</div>
                        <div class="pt-text">${card.pt}</div>
                        <div class="ctx-box"><strong>Contexto:</strong> ${card.ctx}</div>
                        <div class="post-it-container">${exsHTML}</div>
                        <div class="card-actions">
                            <button class="act-btn" onclick="speak('${card.en.replace(/'/g, "\\'")}')">üîä Ouvir</button>
                            <button class="act-btn" onclick="openExamplesModal('${card.uid}')">‚ûï Post-it Exemplo</button>
                            <button class="act-btn" style="color:red; margin-left:auto;" onclick="deleteCard('${card.uid}')">üóëÔ∏è</button>
                        </div>
                    </div>
                `;
                feed.innerHTML += html;
            });
        }

        // --- MODAL DE EXEMPLOS ---
        function openExamplesModal(uid) {
            activeCardId = uid;
            const card = userCards.find(c => c.uid === uid);
            if(!card.availableExs || card.availableExs.length === 0) {
                alert("Nenhum exemplo extra dispon√≠vel para este card legado.");
                return;
            }
            pendingExamples = [...card.availableExs];
            document.getElementById('modalEx').classList.add('show');
            cycleModal();
        }
        
        function cycleModal() {
            if(pendingExamples.length === 0) {
                document.getElementById('modalText').innerText = "N√£o h√° mais exemplos diferentes para esta frase gerados no momento.";
                return;
            }
            const randIndex = Math.floor(Math.random() * pendingExamples.length);
            tempExample = pendingExamples[randIndex];
            document.getElementById('modalText').innerText = `"${tempExample}"`;
        }

        function speakModal() { if(tempExample) speak(tempExample); }

        function saveModal() {
            if(!tempExample) return;
            const card = userCards.find(c => c.uid === activeCardId);
            if(card && !card.savedExs.includes(tempExample)) {
                card.savedExs.push(tempExample);
                saveData();
                renderFeed();
                closeModal('modalEx');
            }
        }

        // --- CONFIGURA√á√ïES E CATEGORIAS ---
        function openSettings() {
            document.getElementById('apiKeyInput').value = localStorage.getItem('gemini_api_key') || "";
            renderSettingsCatList();
            document.getElementById('modalSettings').classList.add('show');
        }

        function saveApiKey() {
            const key = document.getElementById('apiKeyInput').value.trim();
            localStorage.setItem('gemini_api_key', key);
            alert("Chave salva com sucesso!");
        }

        function renderSettingsCatList() {
            const list = document.getElementById('settingsCatList');
            list.innerHTML = '';
            categories.forEach((cat, index) => {
                list.innerHTML += `
                    <div class="cat-list-item">
                        <span style="font-weight:bold;">${cat}</span>
                        <button onclick="deleteCategory(${index})" style="background:none; border:none; color:red; font-size:18px; cursor:pointer;">‚úñ</button>
                    </div>
                `;
            });
        }

        function addCategory() {
            const input = document.getElementById('newCatInput');
            const val = input.value.trim();
            if(val && !categories.includes(val)) {
                categories.push(val);
                localStorage.setItem('englishApp_cats', JSON.stringify(categories));
                input.value = "";
                renderSettingsCatList();
                renderCategoryChips();
            }
        }

        function deleteCategory(index) {
            if(confirm(`Tem certeza que deseja excluir a categoria "${categories[index]}"? (Os cards existentes n√£o ser√£o apagados)`)) {
                categories.splice(index, 1);
                localStorage.setItem('englishApp_cats', JSON.stringify(categories));
                if(currentCat === categories[index]) {
                    currentCat = 'all';
                    localStorage.setItem('englishApp_lastCat', 'all');
                }
                renderSettingsCatList();
                renderCategoryChips();
                renderFeed();
            }
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('show');
            if(modalId === 'modalEx') activeCardId = null;
        }

        // --- RESTO DO C√ìDIGO (SRS, BACKUP) ---
        function toggleHard(uid) {
            const card = userCards.find(c => c.uid === uid);
            if(card) { card.isHard = !card.isHard; if(card.isHard) { card.interval = 1; card.nextReview = Date.now(); } saveData(); renderFeed(); updateReviewBadge(); }
        }

        function switchView(view) {
            const vExp = document.getElementById('viewExplore'); const vRev = document.getElementById('viewReview'); const hExp = document.getElementById('headerExplore');
            if(view === 'explore') {
                vExp.classList.remove('hidden'); hExp.classList.remove('hidden'); vRev.classList.add('hidden');
                document.getElementById('navExp').classList.add('active'); document.getElementById('navRev').classList.remove('active');
                renderFeed(); 
            } else {
                vExp.classList.add('hidden'); hExp.classList.add('hidden'); vRev.classList.remove('hidden');
                document.getElementById('navExp').classList.remove('active'); document.getElementById('navRev').classList.add('active');
                startReview();
            }
        }

        function startReview() {
            reviewQueue = userCards.filter(c => c.nextReview <= Date.now());
            currentReviewIndex = 0; renderReviewCard();
        }

        function renderReviewCard() {
            const container = document.getElementById('reviewContainer');
            if(reviewQueue.length === 0) { container.innerHTML = `<div style="text-align:center;"><div style="font-size:50px;">üéâ</div><h2>Tudo em dia!</h2><button onclick="switchView('explore')" class="act-btn" style="margin:20px auto; background:black; color:white;">Voltar</button></div>`; return; }
            if(currentReviewIndex >= reviewQueue.length) { container.innerHTML = `<div style="text-align:center;"><h2>Sess√£o Conclu√≠da!</h2><button onclick="switchView('explore')" class="act-btn" style="margin:20px auto; background:black; color:white;">Voltar</button></div>`; return; }

            const card = reviewQueue[currentReviewIndex];
            container.innerHTML = `
                <div class="flashcard">
                    <span style="font-size:12px; color:#999; text-transform:uppercase;">${card.cat}</span>
                    <h2 style="font-size:28px; color:var(--primary); margin:20px 0;">${card.en}</h2>
                    <button class="act-btn" style="margin:0 auto;" onclick="speak('${card.en.replace(/'/g, "\\'")}')">üîä Ouvir</button>
                    <button id="revealBtn" onclick="document.getElementById('hiddenArea').classList.add('visible'); this.style.display='none';" style="margin-top:40px; background:black; color:white; padding:15px; border:none; border-radius:15px; width:100%; font-weight:bold;">üëÅÔ∏è Mostrar Resposta</button>
                    <div id="hiddenArea" class="hidden-content">
                        <div style="font-size:20px; font-weight:500; margin-bottom:10px;">${card.pt}</div>
                        <div style="color:#666; font-size:14px;">${card.ctx}</div>
                        <div class="srs-btns">
                            <button class="srs-btn" style="background:var(--red);" onclick="processSRS('hard')">Dif√≠cil ü•µ</button>
                            <button class="srs-btn" style="background:var(--green);" onclick="processSRS('easy')">F√°cil üòé</button>
                        </div>
                    </div>
                </div><p style="margin-top:20px; color:#666;">Card ${currentReviewIndex + 1} de ${reviewQueue.length}</p>`;
        }

        function processSRS(difficulty) {
            const realCard = userCards.find(c => c.uid === reviewQueue[currentReviewIndex].uid);
            if (difficulty === 'hard') { realCard.interval = 1; realCard.isHard = true; } else { realCard.interval = Math.ceil(realCard.interval * 2); realCard.isHard = false; }
            realCard.nextReview = Date.now() + (realCard.interval * 24 * 60 * 60 * 1000);
            saveData(); currentReviewIndex++; renderReviewCard(); updateReviewBadge();
        }

        function backupData() {
            const dataStr = JSON.stringify({ cards: userCards, cats: categories });
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr));
            linkElement.setAttribute('download', 'meus_cards_infinitos.json');
            linkElement.click();
        }

        function restoreData(input) {
            const file = input.files[0]; if(!file) return;
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    const importedCards = Array.isArray(data) ? data : data.cards;
                    if(confirm("Substituir dados atuais pelo backup?")) {
                        userCards = importedCards;
                        if(data.cats) { categories = data.cats; localStorage.setItem('englishApp_cats', JSON.stringify(categories)); }
                        saveData(); location.reload();
                    }
                } catch(err) { alert("Erro ao ler o arquivo."); }
            };
            reader.readAsText(file);
        }

        function updateReviewBadge() { const count = userCards.filter(c => c.nextReview <= Date.now()).length; const badge = document.getElementById('revBadge'); if(count > 0) { badge.innerText = count; badge.classList.remove('hidden'); } else { badge.classList.add('hidden'); } }
        function deleteCard(uid) { if(confirm("Apagar este card?")) { userCards = userCards.filter(c => c.uid !== uid); saveData(); renderFeed(); updateReviewBadge(); } }
        function speak(text) { const u = new SpeechSynthesisUtterance(text); u.lang = 'en-US'; window.speechSynthesis.speak(u); }
        function saveData() { localStorage.setItem('englishApp_v6', JSON.stringify(userCards)); }

    </script>
</body>
</html>